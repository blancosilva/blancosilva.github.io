<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width initial-scale=1">
	<meta name="description" content="Useless math is useful math. It can be used to generate more useless math.
">
	<meta name="author" content="">

	<title>The Nonlocal-means Algorithm</title>

	<!-- Bootstrap core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap theme -->
	<link href="/css/bootstrap-theme.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="/css/blog.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/pygments.css">
</head>

<body role="document">

	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">Francisco Blanco-Silva</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				
				
				<li><a class="page-link" href="/about/">About me</a></li>
				
				
				
				<li><a class="page-link" href="/books/">Books</a></li>
				
				
				
				
				
				
				
				<li><a class="page-link" href="/presentations.html">Presentations</a></li>
				
				
				
				<li><a class="page-link" href="/resume.html">Résumé</a></li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">Teaching <span class="caret"></span></a>
					<ul class="dropdown-menu" role="menu">
						<li class="dropdown-header">Current | Most recent classes</li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2014/08/19/ma141-fall-2014.html">MA141—Fall 2014</a></li>
						
						
						
						<li><a href="/course/2014/08/18/math-122-fall-2014.html">MA122—Fall 2014</a></li>
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2014/01/11/ma-241-spring-2014.html">MA241—Spring 2014</a></li>
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2013/08/22/ma242-fall-2013.html">MA242—Fall 2013</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2012/06/26/ma142-summer-ii-2012.html">MA142—Summer II 2012</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li class="divider"></li>
						<li class="dropdown-header">Selected Class Material</li>
						
						
						<li><a href="/teaching/2014/11/08/past-classes.html">Past Sections of Undergraduate Calculus</a></li>
						
						
						
						<li><a href="/teaching/2014/11/08/Mathematical-Imaging.html">Mathematical Imaging</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/teaching/2010/10/27/an-introduction-to-algebraic-topology.html">An Introduction to Algebraic Topology</a></li>
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/teaching/2010/07/08/ma598r.html">MA598R—Summer 2007</a></li>
						
						
						
						
						
						
						
						
<!-- 						<li>Introduction to the Theory of Distributions</li>
						<li>The Basic Practice of Statistics</li> -->
					</ul>
				</li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>



	<div class="page-content">
		<div class="wrapper">
			<br />
<br />
<br />
<br />
<div class="container theme-showcase" role="main" style="font-size:16px; font-family: Helvetica; width:750px; text-align:justify;">

	<header class="post-header">
		<h1 class="post-title">The Nonlocal-means Algorithm</h1>
		<p class="post-meta">Apr 28, 2010</p>
	</header>

	<article class="post-content">
		<p>The nonlocal-means algorithm [<a href="http://www.google.com/url?sa=t&amp;source=web&amp;ct=res&amp;cd=8&amp;ved=0CC0QFjAH&amp;url=http%3A%2F%2Fciteseerx.ist.psu.edu%2Fviewdoc%2Fdownload%3Fdoi%3D10.1.1.108.6427%26rep%3Drep1%26type%3Dpdf&amp;ei=urzZS42wFZLK8ATlr-DYAQ&amp;usg=AFQjCNF5nJo_13bxj53H8ZMOvHFD8duWSg&amp;sig2=RgRUCN-tGpij-YOp1WjdLA">Buades, Coll, Morel</a>] was designed to perform noise reduction on digital images, while preserving the main geometrical configurations, as well as finer structures, details and texture.  The algorithm is consistent under the condition that one can find many samples of every image detail within the same image.</p>

<table width="100%" style="border-width:0;">
<tbody>
<tr>
<td width="30%" style="border-width:0;"><img src="http://farm4.static.flickr.com/3267/4561651402_faa7cfdfc6_o.jpg" alt="" width="100%" /></td>
<td width="30%" style="border-width:0;"><img src="http://farm3.static.flickr.com/2723/4561651532_1befae6b32_o.jpg" alt="" width="100%" /></td>
<td width="30%" style="border-width:0;"><img src="http://farm4.static.flickr.com/3557/4561651320_217822c20f_o.jpg" alt="" width="100%" /></td>
</tr>
<tr>
<td style="text-align:center;font-family:modern;font-size:12pt;border-width:0;">Barbara</td>
<td style="text-align:center;font-family:modern;font-size:12pt;border-width:0;">Noise added, <tt>std=30</tt></td>
<td style="text-align:center;font-family:modern;font-size:12pt;border-width:0;">Denoised image, <tt>h=93</tt></td>
</tr>
</tbody>
</table>

<p>The algorithm has the following closed form:  Given a finite grid <span>\( \Lambda \subset \mathbb{Z}^2 \)</span> of the form <span>\( \Lambda = \Omega \cap \mathbb{Z}^2 \)</span> for some compact set <span>\( \Omega \subset \mathbb{R}^2 \)</span>, a signal <span>\( f \in L_2(\Lambda,\mathbb{R}^+) \)</span>, and a family of <em>windows</em> <span>\( \{ \mathcal{R}_k \}_{k \in \Lambda} \)</span> satisfying the conditions</p>

<ol>
  <li><span>\( k \in \mathcal{R}_k \)</span> for all <span>\( k \in \Lambda \)</span>.</li>
  <li>If <span>\( j \in \mathcal{R}_k \)</span>, then <span>\( k \in \mathcal{R}_j \)</span>,</li>
</ol>

<p>the nonlocal-means operator <span>\( \text{NL}_h\colon \ell_2(\Lambda,\mathbb{R}) \to \ell_2(\Lambda,\mathbb{R}) \)</span> with filtering parameter <span>\( h&gt;0 \)</span>, is defined by</p>

<div>
	\begin{equation}
\text{NL}_h f(k) = \sum_{j \in \Lambda} \omega_h(j,k) f(j),
\end{equation}
</div>

<p>where the weights <span>\( { \omega_h(j,k) }_{j,k \in \Lambda} \)</span> are defined by</p>

<div>
\begin{equation}
 \omega_h(j,k) = \frac{ \exp \bigg( -\frac{\left\lVert f(\mathcal{R}_j) - f(\mathcal{R}_k) \right\rVert_{2,a}^2}{h^2} \bigg) }{ \sum_{j \in \Lambda} \exp \bigg( - \frac{\left\lVert f(\mathcal{R}_j) - f(\mathcal{R}_k) \right\rVert_{2,a}^2}{h^2} \bigg)}.
\end{equation}
</div>

<p>Here, <span>\( f(\mathcal{R}) \)</span> denotes a <em>patch</em> of the image <span>\( f \)</span> supported on the window <span>\( \mathcal{R} \)</span>.</p>

<p>Notice that the <em>similarity</em> between patches is nothing but a simple Gaussian weighted Euclidean distance, which accounts for difference of grayscales alone. <a href="http://www.google.com/url?sa=t&amp;source=web&amp;ct=res&amp;cd=1&amp;ved=0CAgQFjAA&amp;url=http%3A%2F%2Fgraphics.cs.cmu.edu%2Fpeople%2Fefros%2Fresearch%2FNPS%2Fefros-iccv99.pdf&amp;ei=w7vZS8udFZLK8ATlr-DYAQ&amp;usg=AFQjCNHVEBaLtGLRS97qyp56MEPJ1aeRXg&amp;sig2=b_w4DZt33t0wWIkY0zW6jQ">Efros and Leung</a> prove that this distance is a reliable measure for the comparison of texture patches, and at the same time copes very well with additive white noise; in particular, if <span>\( f \)</span> and <span>\( g \)</span> are respectively the noisy and original images, and <span>\( \sigma^2 \)</span> is the noise variance, then the most similar patches in the noisy image are also expected to be the most similar in the original:</p>

<div>
	\begin{equation}
 \mathbb{E} \left\lVert f(\mathcal{R}_j) - f(\mathcal{R}_k) \right\rVert_{2,a}^2 = \left\lVert g(\mathcal{R}_j) - g(\mathcal{R}_k) \right\rVert_{2,a}^2 + 2\sigma^2 .
 \end{equation}
</div>

	</article>

	
	<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'blancosilva'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

	
</div>


<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

		</div>
	</div>

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56262970-1', 'auto');
  ga('send', 'pageview');

</script>
	<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10117038; 
var sc_invisible=1; 
var sc_security="1fd852f3"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counters" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/10117038/0/1fd852f3/1/"
alt="free hit counters"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

	    <!-- Bootstrap core JavaScript
	    ================================================== -->
	    <!-- Placed at the end of the document so the pages load faster -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	    <script src="/js/bootstrap.min.js"></script>
	    <script src="/assets/js/docs.min.js"></script>
	    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	    <script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
	</body>
	</html>
