<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width initial-scale=1">
	<meta name="description" content="Useless math is useful math. It can be used to generate more useless math.
">
	<meta name="author" content="">

	<title>Edge detection: The Convolution Approach</title>

	<!-- Bootstrap core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap theme -->
	<link href="/css/bootstrap-theme.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="/css/blog.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/pygments.css">


	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body role="document">

	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">Francisco Blanco-Silva</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				
				
				<li><a class="page-link" href="/about/">About me</a></li>
				
				
				
				<li><a class="page-link" href="/books/">Books</a></li>
				
				
				
				
				
				
				
				
				
				<li><a class="page-link" href="/media.html">In the media</a></li>
				
				
				
				<li><a class="page-link" href="/presentations.html">Presentations</a></li>
				
				
				
				<li><a class="page-link" href="/resume.html">Résumé</a></li>
				
				
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">Teaching <span class="caret"></span></a>
					<ul class="dropdown-menu" role="menu">
						<li class="dropdown-header">Current | Most recent classes</li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2014/08/19/ma141-fall-2014.html">MA141—Fall 2014</a></li>
						
						
						
						<li><a href="/course/2014/08/18/math-122-fall-2014.html">MA122—Fall 2014</a></li>
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2014/01/11/ma-241-spring-2014.html">MA241—Spring 2014</a></li>
						
						
						
						
						
						
						
						
						
						<li><a href="/course/2013/08/22/ma242-fall-2013.html">MA242—Fall 2013</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li class="divider"></li>
						<li class="dropdown-header">Selected Class Material</li>
						
						
						<li><a href="/teaching/2014/11/08/past-classes.html">Past Sections of Undergraduate Calculus</a></li>
						
						
						
						<li><a href="/teaching/2014/11/08/Mathematical-Imaging.html">Mathematical Imaging</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/teaching/2010/10/27/an-introduction-to-algebraic-topology.html">An Introduction to Algebraic Topology</a></li>
						
						
						
						<li><a href="/teaching/2010/07/08/ma598r.html">MA598R—Summer 2007</a></li>
						
						
						
						
						
						
						
						
<!-- 						<li>Introduction to the Theory of Distributions</li>
						<li>The Basic Practice of Statistics</li> -->
					</ul>
				</li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>



	<div class="page-content">
		<div class="wrapper">
			<br />
<br />
<br />
<br />

<div class="container theme-showcase" role="main" style="font-size: 16px; base-line-height: 1.5; font-family: Helvetica, Arial, sans-serif; spacing-unit: 30px; line-height: 20px;">

	<header class="post-header">
		<h1 class="post-title">Edge detection: The Convolution Approach</h1>
	</header>

	<article class="post-content">
		<p>Today I would like to show a very basic technique of detection based on simple convolution of an image with small kernels (masks). The purpose of these kernels is to enhance certain properties of the image at each pixel.  What properties?  Those that define what means to be an edge, in a differential calculus way—exactly as it was defined in the description of the <a href="http://blancosilva.github.io/course-material/2011/01/17/edge-detection.html">Canny edge detector</a>.  The big idea is to assign to each pixel a numerical value that expresses its <em>strength as an edge</em>: positive if we suspect that such structure is present at that location, negative if not, and zero if the image is locally flat around that point.  Masks can be designed so that they mimic the effect of differential operators, but these can be terribly complicated and give rise to large matrices.  The first approaches were performed with simple <span>\( 3 \times 3 \)</span> kernels.  For example, Faler came up with the following four simple masks that emulate differentiation:</p>

<div>
	\begin{equation}
	\begin{pmatrix} -1 &amp; 0 &amp; 1\\ -1 &amp; 0 &amp; 1\\ -1 &amp; 0 &amp; 1 \end{pmatrix}\quad \begin{pmatrix} 1 &amp; 1 &amp; 1\\ 0 &amp; 0 &amp; 0 \\ -1 &amp; -1 &amp; -1 \end{pmatrix}\quad \begin{pmatrix} -1 &amp; -1 &amp; -1 \\ -1 &amp; 8 &amp; -1 \\ -1 &amp; -1 &amp; -1 \end{pmatrix}\quad \begin{pmatrix} 0 &amp; 1 &amp; 0 \\ -1 &amp; 0 &amp; 1 \\ 0 &amp; -1 &amp; 0 \end{pmatrix}
	\end{equation}
</div>

<p>Note that, adding all the values of each matrix, one obtains zero.  This is consistent with the third property required for our kernels: in the event of a locally flat area around a given pixel, convolution with any of these will offer a value of zero.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno"> 1</span> <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="lineno"> 2</span> <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span><span class="p">,</span> <span class="n">ndimage</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="k">def</span> <span class="nf">detect_edges</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">masks</span><span class="p">):</span>
<span class="lineno"> 5</span>     <span class="n">edges</span><span class="o">=</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="lineno"> 6</span>     <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">:</span>
<span class="lineno"> 7</span>         <span class="n">edges</span><span class="o">=</span><span class="n">maximum</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">mask</span><span class="p">),</span> <span class="n">edges</span><span class="p">)</span>
<span class="lineno"> 8</span>     <span class="k">return</span> <span class="n">edges</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="n">image</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
<span class="lineno">11</span> <span class="n">Faler</span><span class="o">=</span><span class="p">[</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
<span class="lineno">12</span>         <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
<span class="lineno">13</span>    	<span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
<span class="lineno">14</span> 	<span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span> <span class="p">]</span>
<span class="lineno">15</span> 
<span class="lineno">16</span> <span class="n">edges</span><span class="o">=</span><span class="n">detect_edges</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Faler</span><span class="p">)</span></code></pre></div>

<table style="width:75%;border:0;margin-left:auto;margin-right:auto;">
<tr>
<td style="border:0;width:50%;"><img src="http://farm6.static.flickr.com/5042/5366863591_3b00e8f053_o_d.png" width="100%" /></td>
<td style="border:0;width:50%;"><img src="http://farm6.static.flickr.com/5217/5435176967_4a94234d24_o_d.png" width="100%" /></td>
</tr>
</table>

<p>Note that the computed edges show different intensities; the brighter, the more likely to be a genuine edge—as found by this technique.  With a simple thresholding we should be able to create a True-False image with the required edge map.  How would the reader proceed to find a reliable threshold for this task?</p>

<p>Sobel pushed the technique a little bit further by creating <em>compass gradients</em>.  In a nutshell: at any given pixel, an edge could spread in eight different directions; therefore, we could create for each possibility a different kernel capturing such event.  These are the masks proposed by Sobel, following that philosophy:</p>

<div>
	\begin{equation}
	\begin{array}{cccc}
\begin{pmatrix} 1&amp;2&amp;1\\ 0&amp;0&amp;0\\ -1&amp;-2&amp;-1 \end{pmatrix} &amp;
\begin{pmatrix} 2&amp;1&amp;0\\ 1&amp;0&amp;-1\\ 0&amp;-2&amp;-1 \end{pmatrix} &amp;
\begin{pmatrix} 1&amp;0&amp;-1\\ 2&amp;0&amp;-2\\ 1&amp;0&amp;-1 \end{pmatrix} &amp;
\begin{pmatrix} 0&amp;-1&amp;-2\\ 1&amp;0&amp;-1\\ 2&amp;1&amp;0 \end{pmatrix} \\ \\
\begin{pmatrix} -1&amp;-2&amp;-1\\ 0&amp;0&amp;0\\ 1&amp;2&amp;1 \end{pmatrix} &amp;
\begin{pmatrix} -2&amp;-1&amp;0\\ -1&amp;0&amp;1\\ 0&amp;1&amp;2 \end{pmatrix} &amp;
\begin{pmatrix} -1&amp;0&amp;1\\ -2&amp;0&amp;2\\ -1&amp;0&amp;1 \end{pmatrix} &amp;
\begin{pmatrix} 0&amp;1&amp;2\\ -1&amp;0&amp;1\\ -2&amp;-1&amp;0 \end{pmatrix}
\end{array}
\end{equation}
</div>

<p>You have surely heard also of Kirsch and Prewitt’s edge detectors.  They can also be realized as convolutions with the proper sets of kernels in the same way.  I collected below their corresponding masks for reference.  I leave to the reader the task to run a few experiments, compare the different outputs for the same image, and find good choices of thresholds for each case.  I also encourage you to create your own set of masks: do not restrict yourself to <span>\( 3 \times 3 \)</span> matrices, or only to eight possibilities.  Do you see any connection with wavelets?  If so, how would you combine these two a-priori disconnected ideas to identify edges?</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">Kirsch  = [ [[5,5,5],[-3,0,-3],[-3,-3,-3]],
            [[-3,5,5],[-3,0,5],[-3,-3,-3]],
            [[-3,-3,5],[-3,0,5],[-3,-3,5]],
	    [[-3,-3,-3],[-3,0,5],[-3,5,5]],
	    [[-3,-3,-3],[-3,0,-3],[5,5,5]],
	    [[-3,-3,-3],[5,0,-3],[5,5,-3]],
	    [[5,-3,-3],[5,0,-3],[5,-3,-3]],
	    [[5,5,-3],[5,0,-3],[-3,-3,-3]] ]
Prewitt = [ [[1,1,1],[1,-2,1],[-1,-1,-1]],
            [[1,1,1],[1,-2,-1],[1,-1,-1]],
	    [[1,1,-1],[1,-2,-1],[1,1,-1]],
	    [[1,-1,-1],[1,-2,-1],[1,1,1]],
	    [[-1,-1,-1],[1,-2,1],[1,1,1]],
	    [[-1,-1,1],[1,-2,1],[1,1,1]],
	    [[-1,1,1],[-1,-2,1],[-1,1,1]],
	    [[1,1,1],[-1,-2,1],[-1,-1,1]] ]</code></pre></div>


	</article>

	
	<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'eseprimo'; 

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	

</div>

<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

		</div>
	</div>

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56262970-1', 'auto');
  ga('send', 'pageview');

</script>
	<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10117038; 
var sc_invisible=1; 
var sc_security="1fd852f3"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counters" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/10117038/0/1fd852f3/1/"
alt="free hit counters"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

	    <!-- Bootstrap core JavaScript
	    ================================================== -->
	    <!-- Placed at the end of the document so the pages load faster -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	    <script src="/js/bootstrap.min.js"></script>
	    <script src="/assets/js/docs.min.js"></script>
	    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	    <script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
	</body>
	</html>
